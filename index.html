<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cercle Parfait - Version Pro</title>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #0d0d0d;
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
    }

    .hidden {
        display: none;
    }

    .screen {
        text-align: center;
        padding: 20px;
    }

    button {
        background: #1e90ff;
        color: white;
        border: none;
        padding: 15px 25px;
        margin: 15px;
        font-size: 1.2rem;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.2s;
    }

    button:hover {
        background: #1b7eda;
    }

    #game-container {
        display: none;
        flex-direction: column;
        align-items: center;
        width: 100%;
    }

    #canvas-container {
        background: #111;
        padding: 10px;
        border-radius: 10px;
        box-shadow: 0 0 15px #000;
        margin-bottom: 20px;
    }

    canvas {
        border: 2px solid #333;
        border-radius: 10px;
        touch-action: none;
    }

    #result {
        font-size: 1.5rem;
        margin: 15px;
    }

    #ads {
        position: fixed;
        right: 0;
        top: 0;
        width: 150px;
        height: 100%;
        background: #111;
        padding-top: 20px;
        overflow-y: auto;
        border-left: 2px solid #222;
    }

    #ads iframe, #ads a {
        width: 100%;
        margin-bottom: 20px;
        display: block;
    }

    @media (max-width: 900px) {
        #ads {
            display: none;
        }
    }

</style>
</head>
<body>

<!-- ------------------ ÉCRAN DE CHOIX MOBILE / PC ------------------ -->
<div id="choose-screen" class="screen">
    <h1>Cercle Parfait</h1>
    <p>Sélectionne ton type d'appareil pour optimiser l’expérience :</p>
    <button onclick="startGame('pc')">Je suis sur PC</button>
    <button onclick="startGame('mobile')">Je suis sur Mobile</button>
</div>

<!-- ------------------ JEU ------------------ -->
<div id="game-container">
    <h2>Dessine le cercle le plus parfait possible</h2>
    
    <div id="canvas-container">
        <canvas id="drawArea"></canvas>
    </div>

    <button onclick="evaluate()">Évaluer mon cercle</button>
    <div id="result">Score : --</div>
</div>

<!-- ------------------ PUBLICITÉS ------------------ -->
<div id="ads">
    <h3 style="text-align:center;">Publicité</h3>
    
    <script async src="//pl28147943.effectivegatecpm.com/30/c1/d4/30c1d4e16ee93c6022a4658e04bebe19.js"></script>

    <a href="https://www.effectivegatecpm.com/z7ngguw493?key=077b9c468d6714dfe013b3ef11f4a91d" target="_blank">
        <img src="https://via.placeholder.com/150x300?text=PUB+1" alt="pub">
    </a>

    <a href="https://www.effectivegatecpm.com/bz0w4sqe2?key=abe85d8dd5f18c39b8827f44ef96af47" target="_blank">
        <img src="https://via.placeholder.com/150x300?text=PUB+2" alt="pub">
    </a>
</div>

<script>
let canvas, ctx;
let drawing = false;
let points = [];
let device = "pc";

function startGame(type) {
    device = type;

    document.getElementById("choose-screen").style.display = "none";
    document.getElementById("game-container").style.display = "flex";

    initCanvas();
}

function initCanvas() {
    canvas = document.getElementById("drawArea");
    ctx = canvas.getContext("2d");

    if (device === "pc") {
        canvas.width = 600;
        canvas.height = 600;
    } else {
        canvas.width = window.innerWidth - 40;
        canvas.height = window.innerWidth - 40;
    }

    ctx.lineWidth = 4;
    ctx.lineCap = "round";
    ctx.strokeStyle = "white";

    canvas.addEventListener("mousedown", start);
    canvas.addEventListener("mousemove", draw);
    window.addEventListener("mouseup", stop);

    canvas.addEventListener("touchstart", start);
    canvas.addEventListener("touchmove", draw);
    window.addEventListener("touchend", stop);
}

function getPos(e) {
    if (e.touches) {
        return {
            x: e.touches[0].clientX - canvas.getBoundingClientRect().left,
            y: e.touches[0].clientY - canvas.getBoundingClientRect().top
        };
    }
    return {
        x: e.clientX - canvas.getBoundingClientRect().left,
        y: e.clientY - canvas.getBoundingClientRect().top
    };
}

function start(e) {
    drawing = true;
    points = [];
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    points.push(getPos(e));
}

function draw(e) {
    if (!drawing) return;

    let p = getPos(e);
    points.push(p);

    ctx.beginPath();
    let prev = points[points.length - 2];
    ctx.moveTo(prev.x, prev.y);
    ctx.lineTo(p.x, p.y);
    ctx.stroke();
}

function stop() {
    drawing = false;
}

function evaluate() {
    if (points.length < 10) {
        result.innerHTML = "Score : Trop peu de points";
        return;
    }

    // ----- ANALYSE SÉVÈRE -----

    // 1) centre moyen
    let cx = points.reduce((s,p)=>s+p.x,0)/points.length;
    let cy = points.reduce((s,p)=>s+p.y,0)/points.length;

    // 2) distances au centre (rayons)
    let radii = points.map(p => Math.hypot(p.x - cx, p.y - cy));
    let avg = radii.reduce((s,r)=>s+r,0)/radii.length;

    // 3) variance (stabilité du rayon)
    let variance = radii.reduce((s,r)=>s + Math.pow(r-avg,2),0) / radii.length;
    let stdev = Math.sqrt(variance);

    // 4) circularité = score de 0 à 100
    let score = Math.max(0, 100 - stdev * 3); // beaucoup plus sévère

    result.innerHTML = "Score : " + score.toFixed(1) + "%";
}

</script>

</body>
</html>
