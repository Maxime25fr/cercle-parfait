<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cercle Parfait — Jeu</title>

<style>
    body {
        margin: 0;
        font-family: Arial, sans-serif;
        background: #111;
        color: white;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    h1 {
        margin-top: 20px;
        font-weight: 700;
        text-align: center;
    }

    #deviceSelector {
        margin-top: 20px;
        padding: 20px;
        background: #222;
        border-radius: 12px;
        box-shadow: 0 0 10px #000;
    }

    button {
        padding: 12px 20px;
        font-size: 18px;
        margin: 10px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
        background: #3b82f6;
        color: white;
        transition: 0.2s;
    }

    button:hover {
        background: #1d4ed8;
    }

    #gameContainer {
        display: none;
        flex-direction: column;
        align-items: center;
        width: 95%;
        max-width: 900px;
    }

    #canvas {
        background: #ffffff;
        border: 3px solid #444;
        margin-top: 20px;
        touch-action: none;
    }

    #score {
        font-size: 28px;
        margin-top: 20px;
        padding: 15px 25px;
        background: #222;
        border-radius: 12px;
        box-shadow: 0 0 10px #000;
    }

    .adContainer {
        width: 100%;
        max-width: 900px;
        padding: 15px;
        background: #181818;
        border-radius: 12px;
        margin-top: 20px;
        box-shadow: 0 0 10px #000;
        text-align: center;
    }

    .adTitle {
        font-size: 14px;
        color: #aaa;
        margin-bottom: 10px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

</style>
</head>

<body>

<h1>Cercle Parfait — Dessine le cercle le plus précis possible !</h1>

<!-- Sélection PC / Mobile -->
<div id="deviceSelector">
    <h2>Choisissez votre appareil :</h2>
    <button onclick="startGame('pc')">Ordinateur</button>
    <button onclick="startGame('mobile')">Téléphone</button>
</div>

<!-- Conteneur du jeu -->
<div id="gameContainer">

    <!-- Pub 1 -->
    <div class="adContainer">
        <div class="adTitle">Publicité</div>
        <iframe src="https://www.effectivegatecpm.com/z7ngguw493?key=077b9c468d6714dfe013b3ef11f4a91d" style="width:100%;height:90px;border:none;"></iframe>
    </div>

    <!-- Canvas -->
    <canvas id="canvas"></canvas>

    <button onclick="evaluateDrawing()">Évaluer mon cercle</button>

    <div id="score">Score : en attente…</div>

    <!-- Pub 2 -->
    <div class="adContainer">
        <div class="adTitle">Publicité</div>
        <iframe src="https://www.effectivegatecpm.com/bz0w4sqe2?key=abe85d8dd5f18c39b8827f44ef96af47" style="width:100%;height:250px;border:none;"></iframe>
    </div>

    <!-- Bandeau Pub 3 -->
    <div class="adContainer">
        <div class="adTitle">Publicité sponsorisée</div>

        <script type="text/javascript">
            atOptions = {
                'key' : '506bbbc05cbb873bbe918c633ae6ad39',
                'format' : 'iframe',
                'height' : 60,
                'width' : 468,
                'params' : {}
            };
        </script>
        <script type="text/javascript" src="//www.highperformanceformat.com/506bbbc05cbb873bbe918c633ae6ad39/invoke.js"></script>
    </div>

</div>

<script>
let canvas = document.getElementById("canvas");
let ctx = canvas.getContext("2d");
let drawing = false;
let points = [];
let device = "pc";

function startGame(selected) {
    device = selected;

    document.getElementById("deviceSelector").style.display = "none";
    document.getElementById("gameContainer").style.display = "flex";

    if (device === "mobile") {
        canvas.width = window.innerWidth * 0.9;
        canvas.height = 400;
    } else {
        canvas.width = 600;
        canvas.height = 600;
    }
}

function startDraw(e) {
    drawing = true;
    points = [];
    ctx.clearRect(0, 0, canvas.width, canvas.height);
}

function stopDraw() {
    drawing = false;
}

function draw(e) {
    if (!drawing) return;

    let rect = canvas.getBoundingClientRect();
    let x, y;

    if (device === "mobile") {
        x = e.touches[0].clientX - rect.left;
        y = e.touches[0].clientY - rect.top;
    } else {
        x = e.clientX - rect.left;
        y = e.clientY - rect.top;
    }

    points.push({ x, y });

    ctx.fillStyle = "black";
    ctx.beginPath();
    ctx.arc(x, y, 2, 0, Math.PI * 2);
    ctx.fill();
}

// Calcul du score (version plus stricte)
function evaluateDrawing() {
    if (points.length < 10) {
        document.getElementById("score").innerHTML = "Score : impossible (dessin trop court)";
        return;
    }

    // Calcul du centre moyen
    let cx = points.reduce((a, p) => a + p.x, 0) / points.length;
    let cy = points.reduce((a, p) => a + p.y, 0) / points.length;

    // Rayon moyen
    let radii = points.map(p => Math.hypot(p.x - cx, p.y - cy));
    let rMean = radii.reduce((a, v) => a + v, 0) / radii.length;

    // Écart-type (précision du cercle)
    let variance = radii.reduce((a, v) => a + Math.pow(v - rMean, 2), 0) / radii.length;
    let error = Math.sqrt(variance);

    // Score plus difficile
    let score = Math.max(0, 100 - (error * 4));

    score = Math.round(score);

    document.getElementById("score").innerHTML = "Score : " + score + " / 100";
}

canvas.addEventListener("mousedown", startDraw);
canvas.addEventListener("mouseup", stopDraw);
canvas.addEventListener("mousemove", draw);

canvas.addEventListener("touchstart", startDraw);
canvas.addEventListener("touchend", stopDraw);
canvas.addEventListener("touchmove", draw);
</script>

</body>
</html>
