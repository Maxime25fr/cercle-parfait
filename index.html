<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cercle Parfait - Jeu</title>

<style>
    body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
        background: var(--bg);
        color: var(--text);
        transition: 0.3s;
    }

    :root {
        --bg: #ffffff;
        --text: #000000;
        --panel: #f2f2f2;
    }
    .dark {
        --bg: #121212;
        --text: #ffffff;
        --panel: #1f1f1f;
    }

    header {
        padding: 15px;
        background: var(--panel);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    #canvas-container {
        display: flex;
        justify-content: center;
        margin-top: 20px;
    }

    canvas {
        border: 2px solid var(--text);
        background: white;
        touch-action: none;
    }

    #sidebar {
        width: 350px;
        padding: 15px;
        background: var(--panel);
        height: 100vh;
        overflow-y: auto;
    }

    #layout {
        display: flex;
    }

    .btn {
        padding: 10px 20px;
        background: #0084ff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 5px;
    }

    #score {
        font-size: 24px;
        margin-top: 15px;
        font-weight: bold;
        text-align: center;
    }

    #chooseDev {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.9);
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        z-index: 9999;
    }

    #chooseDev button {
        padding: 20px;
        margin: 10px;
        font-size: 20px;
        background: #00aaff;
        color: white;
        border: none;
        border-radius: 10px;
    }
</style>
</head>

<body class="light">

<!-- Choix PC / Mobile -->
<div id="chooseDev">
    <h2>Choisissez votre appareil</h2>
    <button onclick="setDevice('pc')">Ordinateur</button>
    <button onclick="setDevice('mobile')">Téléphone</button>
</div>

<header>
    <h1>Cercle Parfait</h1>
    <button class="btn" onclick="toggleTheme()">Mode clair / sombre</button>
</header>

<div id="layout">

    <!-- Sidebar -->
    <div id="sidebar">

        <h2>Score</h2>
        <div id="score">Dessine un cercle !</div>

        <h2>Pubs</h2>

        <!-- PUB 1 -->
        <iframe src="https://www.effectivegatecpm.com/z7ngguw493?key=077b9c468d6714dfe013b3ef11f4a91d"
                style="width:100%;height:120px;border:none;"></iframe>

        <br><br>

        <!-- PUB 2 -->
        <iframe src="https://www.effectivegatecpm.com/bz0w4sqe2?key=abe85d8dd5f18c39b8827f44ef96af47"
                style="width:100%;height:120px;border:none;"></iframe>

        <br><br>

        <!-- PUB 3 Bandeau -->
        <div>
            <script type="text/javascript">
                atOptions = {
                    'key': '506bbbc05cbb873bbe918c633ae6ad39',
                    'format': 'iframe',
                    'height': 60,
                    'width': 468,
                    'params': {}
                };
            </script>
            <script type="text/javascript" src="//www.highperformanceformat.com/506bbbc05cbb873bbe918c633ae6ad39/invoke.js"></script>
        </div>
    </div>

    <!-- Zone de dessin -->
    <div id="canvas-container">
        <canvas id="drawCanvas"></canvas>
    </div>

</div>

<script>
/* ---------------------------
   MODE SOMBRE / CLAIR
----------------------------*/
function toggleTheme() {
    document.body.classList.toggle("dark");
}

/* ---------------------------
   CONFIG PC / MOBILE
----------------------------*/
let device = "pc";

function setDevice(type) {
    device = type;
    let canvas = document.getElementById("drawCanvas");

    if (type === "pc") {
        canvas.width = 500;
        canvas.height = 500;
    } else {
        canvas.width = 320;
        canvas.height = 320;
    }

    document.getElementById("chooseDev").style.display = "none";
}

/* ---------------------------
   SYSTEME DE DESSIN
----------------------------*/
const canvas = document.getElementById("drawCanvas");
const ctx = canvas.getContext("2d");
let drawing = false;
let points = [];

canvas.addEventListener("pointerdown", () => {
    drawing = true;
    points = [];
});

canvas.addEventListener("pointermove", e => {
    if (!drawing) return;

    let rect = canvas.getBoundingClientRect();
    let x = e.clientX - rect.left;
    let y = e.clientY - rect.top;

    points.push({x, y});

    ctx.fillStyle = "#000";
    ctx.beginPath();
    ctx.arc(x, y, 2, 0, Math.PI * 2);
    ctx.fill();
});

canvas.addEventListener("pointerup", () => {
    drawing = false;
    evaluateCircle();
});

/* ---------------------------
   CALCUL DU CERCLE
----------------------------*/
function evaluateCircle() {
    if (points.length < 30) {
        document.getElementById("score").innerText = "Dessine un cercle complet !";
        return;
    }

    // Calcul centre moyen
    let cx = points.reduce((a, p) => a + p.x, 0) / points.length;
    let cy = points.reduce((a, p) => a + p.y, 0) / points.length;

    // Distance moyenne (rayon)
    let radius = points.reduce((a, p) => a + Math.hypot(p.x - cx, p.y - cy), 0) / points.length;

    // Écart moyen
    let scoreVar = points.reduce((a, p) => {
        let d = Math.hypot(p.x - cx, p.y - cy);
        return a + Math.abs(d - radius);
    }, 0) / points.length;

    // Score strict !
    let score = Math.max(0, 100 - (scoreVar * 2.2));

    document.getElementById("score").innerHTML =
        "Score : <span style='color:#00aa00'>" + score.toFixed(1) + "%</span>";
}
</script>

</body>
</html>
